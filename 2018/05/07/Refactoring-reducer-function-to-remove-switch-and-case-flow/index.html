<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Refactoring reducer function to remove switch and case flow · Robin's Blog</title><meta name="description" content="Refactoring reducer function to remove switch and case flow - Li Wenzhi"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/wali-2.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://lwz7512.github.io/atom.xml" title="Robin's Blog"></head><body><div class="wrap"><header><div class="title-bar">Robin's Blog<button type="button" class="ltmenu"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div><a href="/" class="logo-link"><img src="/wali-2.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/works/" target="_self" class="nav-list-link">WORKS</a></li><li class="nav-list-item"><a href="/opensource/" target="_self" class="nav-list-link">OPENSOURCE</a></li><li class="nav-list-item"><a href="/notes/" target="_self" class="nav-list-link">QUICKNOTES</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Refactoring reducer function to remove switch and case flow</h1><div class="post-info">May 7, 2018</div><div class="post-content"><h3 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h3><p>Redux introduces reducer function to handle each action, and return new state data. It’s a common usage to write a switch(action.type)/case workflow to process different action. This kind of measure leads to a very long and large reducer function, and mix all the scenarios together.</p>
<p>It’s so ugly to accept, difficult to read and maintain. How to change this? In this post we’ll simplify the reducer logic, and use as little code as possible to make it feel comfortable.</p>
<h3 id="Snippets"><a href="#Snippets" class="headerlink" title="Snippets"></a>Snippets</h3><p>First, we define a struct names types which include all the action names:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const types = &#123;</span><br><span class="line">  ADD_ITEM: &apos;ADD&apos;,</span><br><span class="line">  UPDATE_ITEM: &apos;UPDATE&apos;,</span><br><span class="line">  SWITCH_ITEM: &apos;SWITCH&apos;,</span><br><span class="line">  REMOVE_ITEM: &apos;REMOVE&apos;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>These constants definition is in global scope, defined once and referenced everywhere. we’ll use them later in handler and reducer functions.</p>
<p>A typical reducer function use switch/case flow control to calculate new state by action. Any solution not to use switch sentence? Definitely! The answer is a <strong> map object </strong> like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let handlers = &#123;</span><br><span class="line">  [types.ADD_ITEM]:    hander_ADD,</span><br><span class="line">  [types.UPDATE_ITEM]: hander_UPDATE,</span><br><span class="line">  [types.SWITCH_ITEM]: hander_SWITCH,</span><br><span class="line">  [types.REMOVE_ITEM]: hander_REMOVE</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Compared with switch/case approach, is this implementation much easier to read? The greatest benefit of it is the action process is seperated from reducer, and redefined to a handler_xxx function.</p>
<p>Then, another problem come up, how to handler default action which’s the initial state? The answer is just simple as well:</p>
<p>check existing action first, if not meet the action then return initial state!</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const _reducer = (state = initialState(), action) =&gt; &#123;</span><br><span class="line">  let at = action.type;</span><br><span class="line">  let handlers = &#123;</span><br><span class="line">    [types.ADD_ITEM]:    hander_ADD,</span><br><span class="line">    [types.UPDATE_ITEM]: hander_UPDATE,</span><br><span class="line">    [types.SWITCH_ITEM]: hander_SWITCH,</span><br><span class="line">    [types.REMOVE_ITEM]: hander_REMOVE</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  if(handlers[at]) return handlers[at](state, action);</span><br><span class="line"></span><br><span class="line">  return state;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p> A sample handler function like this:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const hander_REMOVE = (state, action) =&gt; &#123;</span><br><span class="line">  const &#123;notes, index&#125; = state;</span><br><span class="line">  const &#123;type, payload&#125; = action; // from actionCreators</span><br><span class="line"></span><br><span class="line">  return &#123;</span><br><span class="line">    notes: notes.filter((note, i) =&gt; i !== payload),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> Everything looks perfect! we achieved the goal of seperation of concern points.</p>
<p>the complete Redux.js code is <a href="https://github.com/lwz7512/AwesomeNote4Kids/blob/master/app/Redux.js" target="_blank" rel="noopener">here</a>!</p>
<p>…</p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/05/04/Create-form-with-tcomb-form-native/" class="next">NEXT</a></div><div class="copyright"><p>© 2018 <a href="https://lwz7512.github.io">Li Wenzhi</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><!--@2018/04/06--><script>var $toggle = document.querySelector('.ltmenu');
var $navbar = document.querySelector('ul.nav');
$toggle.addEventListener('click', function(){
 if ($navbar.classList.contains('in')) {
    $navbar.classList.remove('in');
 }else{
    $navbar.classList.add('in');
 }
});</script></body></html>