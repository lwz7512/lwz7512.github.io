<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Adding Redux to react-native project Part 1 · Robin's Blog</title><meta name="description" content="Adding Redux to react-native project Part 1 - Li Wenzhi"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/wali-2.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://lwz7512.github.io/atom.xml" title="Robin's Blog"></head><body><div class="wrap"><header><div class="title-bar">Robin's Blog<button type="button" class="ltmenu"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div><a href="/" class="logo-link"><img src="/wali-2.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/works/" target="_self" class="nav-list-link">WORKS</a></li><li class="nav-list-item"><a href="/opensource/" target="_self" class="nav-list-link">OPENSOURCE</a></li><li class="nav-list-item"><a href="/notes/" target="_self" class="nav-list-link">QUICKNOTES</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Adding Redux to react-native project Part 1</h1><div class="post-info">Apr 15, 2018</div><div class="post-content"><h3 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h3><p>After couples of days of learning, I believe I have understand the structure and concepts of Redux. Now it’s time to put it into practice for a real react-native project. My goal is pretty simple: integrating Redux to a react-native seed project by only ONE new source file added. In this way, everything is clear to overview and highlight the points.</p>
<h3 id="Boilerplate"><a href="#Boilerplate" class="headerlink" title="Boilerplate"></a>Boilerplate</h3><p>To create a blank react-native project, I prefer to choose react-native cli rather than create-react-native-app! I’d tried the create-react-native-app &amp; Expo, but I found that toolset might be problematic and inefficient to debug and restart a new dev server.</p>
<p>install react-native cli:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g react-native-cli</span><br></pre></td></tr></table></figure>
<p>create a blank react-native project:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">react-native init AwesomeNatiRedux</span><br></pre></td></tr></table></figure>
<p>then, if we run ‘react-native run-ios’ or ‘react-native run-android’, we’ll see the the Welcome screen in simulator or device(if Android device connected).</p>
<h3 id="Refactoring"><a href="#Refactoring" class="headerlink" title="Refactoring"></a>Refactoring</h3><p>Newly create react-native project code seems incompatible to Visual Studio Code 1.22.1. The editor complains the ‘Props’ only used in .ts file, so commented it and delete the <props>.</props></p>
<p>My cli enviroment is:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ react-native -v</span><br><span class="line">react-native-cli: 2.0.1</span><br><span class="line">react-native: 0.55.2</span><br></pre></td></tr></table></figure>
<p>Opening the AwesomeNatiRedux folder in vs code, we’ll see the two source file, index.js and App.js. One is entry file, another is root Component of the application.</p>
<p>Then, we’ll begin to add Redux to the project step by step.</p>
<ul>
<li>Install redux dependency modules<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save redux</span><br><span class="line">$ npm install --save react-redux</span><br><span class="line">$ npm install</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>now to test installation successful, just run: ‘react-native start’.</p>
<ul>
<li><p>Change file structure<br>To make source file more reasonable and easily manage, we put all the source files into a app directory or src directory, left only index.js in the root of project. So mkdir app and move App.js to app directory. Besides, the redux logic file is going to be put the app directory.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir app</span><br><span class="line">$ mv App.js app/</span><br></pre></td></tr></table></figure>
</li>
<li><p>Change index.js<br>adding a bootstrap component to wrap App, and replacing the originally registered App component as root component:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// Add these imports - Step 1</span><br><span class="line">import App from &apos;./app/App&apos;;</span><br><span class="line">import &#123; Provider &#125; from &apos;react-redux&apos;;</span><br><span class="line">import &#123; store &#125; from &apos;./app/redux&apos;;</span><br><span class="line"></span><br><span class="line">export default class Bootstrap extends Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">                &lt;App /&gt;</span><br><span class="line">            &lt;/Provider&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AppRegistry.registerComponent(&apos;AwesomeNatiRedux&apos;, () =&gt; Bootstrap);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>in this file, we include the redux related component, Provider, to provide App level context for App component, while it just need a store to initiate.</p>
<ul>
<li><p>Create redux.js in app directory<br>the redux.js here includes 3 parts: actions/reducers/store which are indispensable to a Redux application.<br>In index.js above, we need store to reference, so it is exported:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export const store = configureStore();</span><br></pre></td></tr></table></figure>
</li>
<li><p>Refactoring the App.js<br>Why a react app need a Redux help, the answer can be very simple: to seperate or move the component level state to App level. The advantages are also obvious, easy to manage and share.<br>A modified version of App component may like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">export class App extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;View style=&#123;styles.container&#125;&gt;</span><br><span class="line">        &lt;Text style=&#123;styles.welcome&#125;&gt;</span><br><span class="line">          &#123;this.props.welcome&#125;</span><br><span class="line">        &lt;/Text&gt;</span><br><span class="line">        &lt;Text style=&#123;styles.instructions&#125;&gt;</span><br><span class="line">          &#123;this.props.start&#125;</span><br><span class="line">        &lt;/Text&gt;</span><br><span class="line">        &lt;Text style=&#123;styles.instructions&#125;&gt;</span><br><span class="line">          &#123;this.props.instructions&#125;</span><br><span class="line">        &lt;/Text&gt;</span><br><span class="line">        &lt;Button</span><br><span class="line">          onPress=&#123;()=&gt;this.props.eventHandlerWithParam(&apos;Payload Sent!&apos;)&#125;</span><br><span class="line">          // onPress=&#123;this.props.eventHandlerNoParam&#125;</span><br><span class="line">          title=&quot;Learn More&quot;</span><br><span class="line">          color=&quot;#841584&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/View&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Magic part:<br>Compared with the initial version of it, you’ll find that state have been replaced to props, which means properties. How to achieve this?<br>Three function: mapStateToProps, mapDispatchToProps, connect.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">// inject app state from redux</span><br><span class="line">const mapStateToProps = (state, ownProps) =&gt; &#123;</span><br><span class="line">  console.log(&apos;new state Got!&apos;);</span><br><span class="line">  // set properties from state</span><br><span class="line">  return &#123;</span><br><span class="line">    welcome: state.welcome,</span><br><span class="line">    start: state.start,</span><br><span class="line">    instructions: state.instructions,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// inject UI event handler from actions</span><br><span class="line">// now got property activateGeodP &amp; closeGeodP</span><br><span class="line">const mapDispatchToProps = &#123;</span><br><span class="line">  eventHandlerWithParam: activateGeodX,</span><br><span class="line">  eventHandlerNoParam: closeGeodX,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// Wrap App component with Connect component,</span><br><span class="line">// and create interaction channel(props) for it.</span><br><span class="line">const AppContainer = connect(</span><br><span class="line">  mapStateToProps,</span><br><span class="line">  mapDispatchToProps</span><br><span class="line">)(App);</span><br><span class="line"></span><br><span class="line">export default AppContainer;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>that’s the main refactoring process of react-native project to add Reduct support.</p>
<p>the complete project source code is <a href="https://github.com/lwz7512/AwesomeNatiRedux" target="_blank" rel="noopener">here</a>.</p>
<p>Enjoy!</p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/04/17/Adding-Redux-to-react-native-project-Part-2/" class="prev">上一篇</a><a href="/2018/04/12/Understand-Reactjs-and-Redux-step-2/" class="next">下一篇</a></div><div class="copyright"><p>© 2018 <a href="https://lwz7512.github.io">Li Wenzhi</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><!--@2018/04/06--><script>var $toggle = document.querySelector('.ltmenu');
var $navbar = document.querySelector('ul.nav');
$toggle.addEventListener('click', function(){
 if ($navbar.classList.contains('in')) {
    $navbar.classList.remove('in');
 }else{
    $navbar.classList.add('in');
 }
});</script></body></html>