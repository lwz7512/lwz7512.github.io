<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Adding Redux to react-native project Part 2 · Robin's Blog</title><meta name="description" content="Adding Redux to react-native project Part 2 - Li Wenzhi"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/wali-2.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://lwz7512.github.io/atom.xml" title="Robin's Blog"></head><body><div class="wrap"><header><div class="title-bar">Robin's Blog<button type="button" class="ltmenu"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div><a href="/" class="logo-link"><img src="/wali-2.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/works/" target="_self" class="nav-list-link">WORKS</a></li><li class="nav-list-item"><a href="/opensource/" target="_self" class="nav-list-link">OPENSOURCE</a></li><li class="nav-list-item"><a href="/notes/" target="_self" class="nav-list-link">QUICKNOTES</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Adding Redux to react-native project Part 2</h1><div class="post-info">Apr 17, 2018</div><div class="post-content"><h3 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h3><p>Last post we introduced Redux to a blank react-native project primarily. In this post we’ll add Redux to a TODO list app, and also to implement a persistence feature to save added TODO item.</p>
<p>We borrow a well-written <a href="http://www.reactnativeexpress.com/data_component_state" target="_blank" rel="noopener">TODO list app</a> as a starting point, in this way we’ll save a lot of energy to understand the mechanism of Redux.</p>
<h3 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h3><p>To start refactoring, first we need to install Redux and redux-persist dependencies.</p>
<p>Adding belowing modules into package.json dependencies:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;react-redux&quot;: &quot;^5.0.7&quot;,</span><br><span class="line">&quot;redux&quot;: &quot;^3.7.2&quot;,</span><br><span class="line">&quot;redux-persist&quot;: &quot;^5.9.1&quot;</span><br></pre></td></tr></table></figure>
<p>instead installation one by one, this time we install all in one command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install</span><br></pre></td></tr></table></figure>
<h3 id="Snippets"><a href="#Snippets" class="headerlink" title="Snippets"></a>Snippets</h3><ul>
<li>Change index.js, add Redux, persistence, App component wrapper :</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Provider &#125; from &apos;react-redux&apos;;</span><br><span class="line">import &#123; PersistGate &#125; from &apos;redux-persist/integration/react&apos;</span><br><span class="line"></span><br><span class="line">import App from &apos;./app/App&apos;;</span><br><span class="line">import configureStore from &apos;./app/Redux&apos;;</span><br><span class="line"></span><br><span class="line">const &#123; store, persistor &#125; = configureStore();</span><br><span class="line"></span><br><span class="line">export default class Bootstrap extends Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">                &lt;PersistGate loading=&#123;null&#125; persistor=&#123;persistor&#125;&gt;</span><br><span class="line">                    &lt;App/&gt;</span><br><span class="line">                &lt;/PersistGate&gt;</span><br><span class="line">            &lt;/Provider&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AppRegistry.registerComponent(&apos;AwesomeProject2&apos;, () =&gt; Bootstrap);</span><br></pre></td></tr></table></figure>
<p>Last post we explained the reason why using Provider outside of App. This example we added a NEW <strong> PersistGate </strong> to wrap App, enable it to automaticlly save the state to device. The persistor is a new stuff introduced later.</p>
<ul>
<li>Change App.js, connect component to Redux, deliver data by dispatch action :</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import &#123; actionCreators &#125; from &apos;./Redux&apos;</span><br><span class="line"></span><br><span class="line">onAddTodo = (text) =&gt; &#123;</span><br><span class="line">  // const &#123;todos&#125; = this.state</span><br><span class="line">  // this.setState(&#123;</span><br><span class="line">  //   todos: [text, ...todos],</span><br><span class="line">  // &#125;)</span><br><span class="line"></span><br><span class="line">  this.props.dispatch(actionCreators.add(text))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">onRemoveTodo = (index) =&gt; &#123;</span><br><span class="line">  // const &#123;todos&#125; = this.state</span><br><span class="line">  // this.setState(&#123;</span><br><span class="line">  //   todos: todos.filter((todo, i) =&gt; i !== index),</span><br><span class="line">  // &#125;)</span><br><span class="line"></span><br><span class="line">  this.props.dispatch(actionCreators.remove(index))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>As you have seen, the big changes to this component is the way it process data, rather than using setState it use <strong> props.dispatch() </strong> . Where doest it come? The answer is in connect function:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// inject app state from redux, then add new property todos to App component</span><br><span class="line">const mapStateToProps = (state, ownProps) =&gt; (&#123;</span><br><span class="line">  todos: state.todos,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// Wrap App component with Connect component,</span><br><span class="line">// and create interaction channel(props) for it.</span><br><span class="line">const AppContainer = connect(</span><br><span class="line">  mapStateToProps</span><br><span class="line">)(App);</span><br></pre></td></tr></table></figure></p>
<p>in mapStateToProps function App component obtained a new property named ‘todos’, how to use it?</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">  // const &#123;todos&#125; = this.state</span><br><span class="line">  const &#123;todos&#125; = this.props</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;View&gt;</span><br><span class="line">      &lt;Title&gt;</span><br><span class="line">        To-Do List</span><br><span class="line">      &lt;/Title&gt;</span><br><span class="line">      &lt;Input</span><br><span class="line">        placeholder=&#123;&apos;Type a todo, then hit enter!&apos;&#125;</span><br><span class="line">        onSubmitEditing=&#123;this.onAddTodo&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;List</span><br><span class="line">        list=&#123;todos&#125;</span><br><span class="line">        onPressItem=&#123;this.onRemoveTodo&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/View&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Again, we don’t use state anymore, using <strong> props </strong> instead!</p>
<ul>
<li>last, we have a look at new Redux.js</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// Initial state of the store</span><br><span class="line">const initialState = &#123;</span><br><span class="line">    todos: [&apos;Click to remove&apos;, &apos;Learn React Native&apos;, &apos;Write Code&apos;, &apos;Ship App&apos;],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Helper functions to dispatch actions, optionally with payloads</span><br><span class="line">export const actionCreators = &#123;</span><br><span class="line">    add: (item) =&gt; &#123;</span><br><span class="line">      return &#123;type: &apos;ADD&apos;, payload: item&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    remove: (index) =&gt; &#123;</span><br><span class="line">      return &#123;type: &apos;REMOVE&apos;, payload: index&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We seperate app state/data into Redux, so, initial data moved to here from App.js. Also, actions definded here for simplification.</p>
<p>last but not at least is the store creation function:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">const _reducer = (state = initialState, action) =&gt; &#123;</span><br><span class="line">    // console.log(state);</span><br><span class="line"></span><br><span class="line">    const &#123;todos&#125; = state;</span><br><span class="line">    const &#123;type, payload&#125; = action;</span><br><span class="line"></span><br><span class="line">    switch (action.type) &#123;</span><br><span class="line">        case &apos;ADD&apos;:</span><br><span class="line">        return &#123;</span><br><span class="line">            todos: [payload, ...todos],</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        case &apos;REMOVE&apos;:</span><br><span class="line">        return &#123;</span><br><span class="line">            todos: todos.filter((todo, i) =&gt; i !== payload),</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        default:</span><br><span class="line">        // return default value while app start</span><br><span class="line">        return state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// store.js</span><br><span class="line">// with persistence support</span><br><span class="line">export default function configureStore() &#123;</span><br><span class="line"></span><br><span class="line">    const persistedReducer = persistReducer(persistConfig, _reducer)</span><br><span class="line"></span><br><span class="line">    const store = createStore(persistedReducer);</span><br><span class="line">    let persistor = persistStore(store)</span><br><span class="line"></span><br><span class="line">    return &#123; store, persistor &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>the big difference from the last post is that we use persistedReducer to create store, and a new stuff persistor created as the same time.</p>
<p>Remember the usage of persistor? It’s used by PersistGate component in index.js.</p>
<p>So, that’s the main points we need to notice in a persistenc enchanced Redux RNA. The complete source code for this app is in <a href="https://github.com/lwz7512/AwesomeProject2" target="_blank" rel="noopener">here</a>!</p>
<p>It can be used even in your daily life, isn’t it?</p>
<p>Enjoy!</p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/04/15/Adding-Redux-to-react-native-project-Part-1/" class="next">NEXT</a></div><div class="copyright"><p>© 2018 <a href="https://lwz7512.github.io">Li Wenzhi</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><!--@2018/04/06--><script>var $toggle = document.querySelector('.ltmenu');
var $navbar = document.querySelector('ul.nav');
$toggle.addEventListener('click', function(){
 if ($navbar.classList.contains('in')) {
    $navbar.classList.remove('in');
 }else{
    $navbar.classList.add('in');
 }
});</script></body></html>